<!doctype html>
<html class="no-js" lang="en">
<head>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Workout Wednesday Week 6 - Butterfly bar chart in Trellis format</title>
	<link rel="stylesheet" href="http://www.visualvantage.io/assets/css/styles_inchmeal.css"/>
	<link rel="alternate" type="application/rss+xml" title="Inchmeal RSS" href="/rss-feed.xml" />

	<script src="http://www.visualvantage.io/assets/js/inchmeal_head.js"></script>

	
	
	<script type="text/javascript"
			src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
	
	<script>
		MathJax.Hub.Config({
			"HTML-CSS": { scale: 82 },
			"displayAlign": "left"
		});
	</script>
	

	
	
	<meta name="description" content="Inchmeal | Workout Wednesday Week 6 - Butterfly bar chart in Trellis format"/>

	

	



	
	<link rel="icon" sizes="32x32" href="http://www.visualvantage.io/assets/img/favicon-32x32.png">




	
	<link rel="icon" sizes="192x192" href="http://www.visualvantage.io/assets/img/touch-icon-192x192.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="180x180" href="http://www.visualvantage.io/assets/img/apple-touch-icon-180x180-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://www.visualvantage.io/assets/img/apple-touch-icon-152x152-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.visualvantage.io/assets/img/apple-touch-icon-144x144-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://www.visualvantage.io/assets/img/apple-touch-icon-120x120-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.visualvantage.io/assets/img/apple-touch-icon-114x114-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://www.visualvantage.io/assets/img/apple-touch-icon-76x76-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.visualvantage.io/assets/img/apple-touch-icon-72x72-precomposed.png">




	
	<link rel="apple-touch-icon-precomposed" href="http://www.visualvantage.io/assets/img/apple-touch-icon-precomposed.png">	




	
	<meta name="msapplication-TileImage" content="http://www.visualvantage.io/assets/img/msapplication_tileimage.png"/>




	
	<meta name="msapplication-TileColor" content="#fabb00">



	<!-- Facebook Optimization -->
	<meta property="og:locale" content="en_EN" />
	
	<meta property="og:title" content="Workout Wednesday Week 6 - Butterfly bar chart in Trellis format" />
	<meta property="og:description" content="Data Visualisation"/>
	<meta property="og:url" content="http://www.visualvantage.io//2017/02/12/workout-wednesday-week6.html" />
	<meta property="og:site_name" content="visual vantage" />
	

	

	<!-- Search Engine Optimization -->
	

	<link type="text/plain" rel="author" href="http://www.visualvantage.io//humans.txt" />

	
</head>

<body id="top-of-page" class="">
	
<div id="navigation" class="sticky">
  <nav class="top-bar" data-topbar>
    <ul class="title-area">
      <li class="name">
        <h1>
          <a href="http://www.visualvantage.io">
            <img src="http://www.visualvantage.io/assets/img/logo.png"/>
          </a>
        </h1>
      </li>
       <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu"(text inside span) to just have icon alone -->
      <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
    </ul>
    <section class="top-bar-section">

      <ul class="right">
        

              

          
          
              <li class="divider"></li>
              <li><a href="http://www.visualvantage.io/">home</a></li>
          
        

              

          
          
              <li class="divider"></li>
              <li><a href="http://www.visualvantage.io/archives/">archive</a></li>
          
        

              

          
          
              <li class="divider"></li>
              <li><a href="http://www.visualvantage.io/about/">about</a></li>
          
        
        
      </ul>

      <ul class="left">
        <li class="divider"></li>
        

              

          
          
        

              

          
          
        

              

          
          
        
        
      </ul>
    </section>
  </nav>
</div><!-- /#navigation -->


	<div class="row t30">
    <div class="medium-8 columns medium-offset-2 end">

        <article itemscope itemtype="http://schema.org/Article">
            <header>
				<span itemprop="name">
					<h1>Workout Wednesday Week 6 - Butterfly bar chart in Trellis format</h1>
				</span>
            </header>

            
            <p class="tm10">
                
                <time class="post-date pr20" datetime="February 12, 2017" itemprop="datePublished"> February 12, 2017</time>
                
                
                <span><a title="View all posts in tableau" href="/archives/#search/tableau"><span class="radius info label">tableau</span></a> <a title="View all posts in WorkoutWednesday" href="/archives/#search/WorkoutWednesday"><span class="radius info label">WorkoutWednesday</span></a> <a title="View all posts in trellis-chart" href="/archives/#search/trellis-chart"><span class="radius info label">trellis-chart</span></a> <a title="View all posts in butterfly-chart" href="/archives/#search/butterfly-chart"><span class="radius info label">butterfly-chart</span></a> </span>
                
            </p>
            

            

			<span itemprop="articleSection">
            <hr/>

            


			<p>This week’s Workout Wednesday was given by <a href="http://www.womanindata.co.uk/">Emma Whyte</a> (@EmmaWhyte).
The challenge was to recreate the below viz using UK population data from the <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationprojections/datasets/localauthoritiesinenglandtable2">ONS website</a></p>

<!--more-->

<p><img src="http://www.visualvantage.io/assets/img/wowed/wk6/goal.png" class="alignimgcenter" itemprop="image" /></p>

<h4 id="some--info-about-the-viz">Some  info about the viz:</h4>

<p>Each part of the trellis is a year, from 2015-2039. Each side of the butterfly is either the percentage of males or females by age group. The black line is the national average, the bars are the percentage for the local authority you have selected.
The aim of this chart was to give the user an indication of whether the percentage of males or females in their local area was on par with the national average; how this changes over time; and if there were any age groups that were either more female or male.</p>

<h4 id="some-rules-for-re-creating-this-viz">Some rules for re-creating this viz:</h4>

<ul>
  <li>Remove the year 2014 (to create an even trellis)</li>
  <li>Filter the original data to remove the local authority ‘England’ and the age group ‘all ages’ (these are unnecessary total lines in the data)</li>
  <li>Pull out male and female population numbers, then make them percentages</li>
  <li>Find out the national average for males and females</li>
  <li>Be able to filter to one local authority at a time (not select all - this makes for a messy &amp; slow viz!)</li>
  <li>Display a label on each trellis part for the year</li>
  <li>The sheet title should change depending on the local authority you select</li>
  <li>My dashboard size is 1000x800 pixels</li>
  <li>Font: Tableau Bold for the titles and then Tableau Book for all other text</li>
  <li>Format the chart lines to be dashes</li>
</ul>

<h4 id="initial-thoughts">Initial thoughts:</h4>

<p>It was my first time preparing trellis chart so I was pretty excited.</p>

<h4 id="things-which-seem-easy-at-this-point">Things which seem easy at this point:</h4>

<ul>
  <li>The calculations for populations % looked simple enough.</li>
  <li>Formatting, labeling and filtering looks pretty doable</li>
  <li>For the national average line LOD calculation at year and age level should be sufficient</li>
</ul>

<h4 id="things-not-so-easy">Things not so easy:</h4>

<ul>
  <li>I had no idea how to divide the viz into columns and rows so would have to look at some tutorial for that</li>
</ul>

<p>With these thoughts I loaded up the data extract provided by Emma. I chose to use .tde extract this time to see how they are used. I have only used excel sheets till now. since .tde came with filtered and manipulated data, it was quite easy to use.</p>

<p>To begin with I looked for some tutorial on trellis chart and got this <a href="http://www.vizwiz.com/2016/03/tableau-tip-tuesday-how-to-create-small.html">post</a> by Andy Kriebel which helped in understanding how to divide columns and rows in trellis chart.</p>

<h4 id="these-are-the-calculations-which-we-use-to-divide-the-columns-and-rows">These are the calculations which we use to divide the columns and rows:</h4>

<p>Column Divider:     <br />
<script type="math/tex">( \text{ index() } - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ())))</script></p>

<p>Row Divider      <br />
<script type="math/tex">\text{ int } ( { ( \text{ index() } - 1 ) } / { ( \text{ round }( \text{ sqrt } ( \text{ size } ())) ) } )</script></p>

<p>The calculations worked perfectly when we used “compute with” set to year after putting “column divider” on column shelf and “row divider” on row shelf.
But I couldn’t really wrap my head around the calculation. What exactly was it doing? why subtracting 1 from Index()? why a modulus in column and division in rows? So I dig in a little and this is what I understood</p>

<p>What we want is to divide the total entities (in our case: 25 years) as evenly as possible in rows and columns like a matrix.
We need a way to tell each entity to go to a specific cell in the matrix lets say 4th column and 5th row. specifically, we need to assign every entity a row number and a column number</p>

<p>So this is what we need to do:</p>

<ul>
  <li>take total number of entities to be placed in the matrix (Size()=25)</li>
  <li>now to get symmetric distribution, we should have equal number of rows and columns lets say “n”.Thus total entities should be n rows <script type="math/tex">\times</script> n columns which is <script type="math/tex">n^2</script>. Now if we have total entities = T, then <script type="math/tex">n^2 = T</script>, which gives us <script type="math/tex">n= \sqrt{T}</script>. Thus we need to take square root of total entities to get number of rows and columns.</li>
  <li>round it to the nearest integer (If total entities were 27 then square root would be 5.19 which on rounding will become 5)</li>
  <li>subtract 1 from Index() to get the first index as 0 as the index() gives 1 by default but tableau starts placing items starting from index 0.</li>
</ul>

<p><strong>For columns now:</strong>  <script type="math/tex">( \text{ index() } - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ())))</script></p>

<p>Col index for <script type="math/tex">1^{st}</script> entity: <script type="math/tex">\quad ( 1 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 0 \mathbin{\%} 5 \quad = \quad 0</script>    <br />
Col index for <script type="math/tex">2^{nd}</script> entity: <script type="math/tex">\quad ( 2 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 1 \mathbin{\%} 5 \quad = \quad 1</script>   <br />
Col index for <script type="math/tex">3^{rd}</script> entity: <script type="math/tex">\quad ( 3 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 2 \mathbin{\%} 5 \quad = \quad 2</script>  <br />
Col index for <script type="math/tex">4^{th}</script> entity: <script type="math/tex">\quad ( 4 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 3 \mathbin{\%} 5 \quad = \quad 3</script>  <br />
Col index for <script type="math/tex">5^{th}</script> entity: <script type="math/tex">\quad ( 5 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 4 \mathbin{\%} 5 \quad = \quad 4</script>  <br />
Col index for <script type="math/tex">6^{th}</script> entity: <script type="math/tex">\quad ( 6 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 5 \mathbin{\%} 5 \quad = \quad 0</script>  <br />
Col index for <script type="math/tex">7^{th}</script> entity: <script type="math/tex">\quad ( 7 - 1) \mathbin{\%} ( \text{ round }( \text{ sqrt } ( \text{ size } ()))) \quad = \quad 6 \mathbin{\%} 5 \quad = \quad 1</script></p>

<p>and so on. this way we have 5 columns from 0 to 4.</p>

<p><strong>For rows:</strong>  <script type="math/tex">\text{ int } ( { ( \text{ index() } - 1 ) } / { ( \text{ round }( \text{ sqrt } ( \text{ size } ())) ) } )</script></p>

<p>Row index for <script type="math/tex">1^{st}</script> entity: <script type="math/tex">\text{  } \text{int} (( 1 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(0 / 5) \text{  } = \text{  } \text{int}(0.0) \text{  } = \text{  } 0</script>    <br />
Row index for <script type="math/tex">2^{nd}</script> entity: <script type="math/tex">\text{  } \text{int} (( 2 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(1 / 5) \text{  } = \text{  } \text{int}(0.2) \text{  } = \text{  } 0</script>    <br />
Row index for <script type="math/tex">3^{rd}</script> entity: <script type="math/tex">\text{  } \text{int} (( 3 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(2 / 5) \text{  } = \text{  } \text{int}(0.4) \text{  } = \text{  } 0</script>    <br />
Row index for <script type="math/tex">4^{th}</script> entity: <script type="math/tex">\text{  } \text{int} (( 4 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(3 / 5) \text{  } = \text{  } \text{int}(0.6) \text{  } = \text{  } 0</script>    <br />
Row index for <script type="math/tex">5^{th}</script> entity: <script type="math/tex">\text{  } \text{int} (( 5 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(4 / 5) \text{  } = \text{  } \text{int}(0.8) \text{  } = \text{  } 0</script>    <br />
Row index for <script type="math/tex">6^{th}</script> entity: <script type="math/tex">\text{  } \text{int} (( 6 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(5 / 5) \text{  } = \text{  } \text{int}(1.0) \text{  } = \text{  } 1</script>    <br />
Row index for <script type="math/tex">7^{th}</script> entity: <script type="math/tex">\text{  } \text{int} (( 7 - 1) / ( \text{ round }( \text{ sqrt } ( \text{ size } ())))) \text{  } = \text{  } \text{int}(6 / 5) \text{  } = \text{  } \text{int}(1.2) \text{  } = \text{  } 1</script></p>

<p>and so on.</p>

<p>This way after every five entities the row number is changing. Here, INT( ) is cleverly being used to round off the number to closest integer towards zero. This can also be achieved by Floor() which rounds a number to the nearest integer of equal or lesser value.</p>

<p>This gave us the desired result of distributing the entities in rows and columns.</p>

<p><img src="http://www.visualvantage.io/assets/img/wowed/wk6/matrix.png" class="alignimgcenter" itemprop="image" /></p>

<p>Once I understood this the rest of the calculations were pretty straightforward.</p>

<p>First calculating the male and female population numbers</p>

<p><img src="http://www.visualvantage.io/assets/img/wowed/wk6/mpop.png" class="alignimgcenter" itemprop="image" />
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/fpop.png" class="alignimgcenter" itemprop="image" /></p>

<p>Since I wanted to plot male population on the reverse axis I also calculated a negative of male population.
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/mpopn.png" class="alignimgcenter" itemprop="image" /></p>

<p>Then calculating their percent out of total population</p>

<p><img src="http://www.visualvantage.io/assets/img/wowed/wk6/mpopper.png" class="alignimgcenter" itemprop="image" />
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/fpopper.png" class="alignimgcenter" itemprop="image" /></p>

<p>I arrived here by plotting the above numbers.
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/matrix2.png" class="alignimgcenter" itemprop="image" /></p>

<p>To get rid of the negative sign in the male population axis, I formatted it to show negative numbers as positive.
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/negformat.png" class="alignimgcenter" itemprop="image" /></p>

<p>Then I calculated the national averages by LOD calculation by fixing the year and age group
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/nfa.png" class="alignimgcenter" itemprop="image" />
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/nma.png" class="alignimgcenter" itemprop="image" /></p>

<p>Also, the national average percent out of total the same way
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/nfaper.png" class="alignimgcenter" itemprop="image" />
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/nmaper.png" class="alignimgcenter" itemprop="image" /></p>

<p>I plotted the national averages on as dual axis and changed the marks type to line.
Also as suggested by <a href="http://www.vizwiz.com/2017/02/ww6.html">Andy</a>, I highlighted the bars to show different colors for values above and below the national averages. I couldnt put the year labels as recommended by Emma so I just placed them where they looked fine.</p>

<p>This is the final dashboard. <em>(Click on the image to view the interactive version)</em></p>

<div>
<a href="https://public.tableau.com/views/UKpopulationchangefrom2015to2039/HowwilltheUKpopulationchangeby2039?:embed=y&amp;:display_count=yes">
<img src="http://www.visualvantage.io/assets/img/wowed/wk6/final.png" class="alignimgcenter" itemprop="image" />
</a>
</div>


            <hr/>
			</span>

            
            <p class="tm10">
                <span><a title="View all posts in tableau" href="/archives/#search/tableau"><span class="radius info label">tableau</span></a> <a title="View all posts in WorkoutWednesday" href="/archives/#search/WorkoutWednesday"><span class="radius info label">WorkoutWednesday</span></a> <a title="View all posts in trellis-chart" href="/archives/#search/trellis-chart"><span class="radius info label">trellis-chart</span></a> <a title="View all posts in butterfly-chart" href="/archives/#search/butterfly-chart"><span class="radius info label">butterfly-chart</span></a> </span>
            </p>
            

            <p class="b60">
                
                <a class="left icon-chevron-left r15" title="Workout Wednesday Week 5 - Distribution bands with Medians" href="/2017/02/03/workout-wednesday-week5.html">previous </a>
                
                
                <a class="right " title="Workout Wednesday Week 7 - Dynamic Trellis Chart" href="/2017/02/17/workout-wednesday-week7.html">next <span class="icon-chevron-right"></span></a>
                
            </p>

            <br/>

            
            

	<div id="disqus_thread"></div>
	<script>
		/**
		 * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
		 * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
		 */
		var disqus_identifier = 'visualvantage';

		
		var disqus_config = function () {
		 //this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
		 this.page.identifier = "/2017/02/12/workout-wednesday-week6.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
		};
		


		(function() { // DON'T EDIT BELOW THIS LINE
			var d = document, s = d.createElement('script');

			s.src = '//' + disqus_identifier + '.disqus.com/embed.js';

			s.setAttribute('data-timestamp', +new Date());
			(d.head || d.body).appendChild(s);
		})();
	</script>
	<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>






            
        </article>
    </div><!-- /.medium-8.columns -->

</div><!-- /.row -->


	    <div id="up-to-top" class="row">
      <div class="small-12 columns" style="text-align: right;">
        <a class="iconfont" title="Go to Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast')">&#xf108;</a>
      </div><!-- /.small-12.columns -->
    </div><!-- /.row -->

    <footer id="footer-content" class="bg-grau">
      <div id="subfooter">
        <nav class="row">
          <section id="subfooter-left" class="small-6 columns">
                <div class="column pl0 pr0">
                    <ul class="inline-list">
                        <li>Created with &hearts; by tarannum</li>
                    </ul>
                </div>
                <div class="column pl0 pr0">
                    <ul class="inline-list">
                        
                        <li><a href="/rss-feed.xml"  target="_blank"  class="rss-link" title="Subscribe to RSS">RSS</a></li>
                        
                        <li><a href="mailto:tarannum.in@gmail.com"  class="contact-link" title="Contact">Contact</a></li>
                        
                    </ul>
                </div>
              <div class="column pl0 pr0">
                  <ul class="inline-list">
                      <li>&copy;2017 visual vantage</li>
                  </ul>
              </div>
          </section>
          <section id="subfooter-right" class="small-6 columns social-icons end">
              <div class="column pl0 pr0">
              <ul class="inline-list">
                
                  <li><a href="http://twitter.com/tarannum_in" target="_blank" class="icon-twitter" title="Follow on twitter"></a></li>
                
                  <li><a href="http://github.com/taraansa" target="_blank" class="icon-github" title="Follow on github"></a></li>
                
              </ul>
              </div>
          </section>
        </nav>
      </div><!-- /#subfooter -->
    </footer>


	<script src="http://www.visualvantage.io/assets/js/inchmeal_all.js"></script>

<script>
  var sectionName = "";
  
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91365673-1', 'auto');
  ga('send', 'pageview');
  
</script>
</body>
</html>
